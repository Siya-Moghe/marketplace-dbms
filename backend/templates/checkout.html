{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Checkout</h2>

  {% if cart_items %}
  <h4 class="mt-3">Your Cart</h4>
  <table class="table table-bordered mt-2">
    <thead>
      <tr>
        <th>Product</th>
        <th>Variant</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody>
      {% for item in cart_items %}
      <tr>
        <td>{{ item.ProductName }}</td>
        <td>{{ item.Size }} / {{ item.Color }}</td>
        <td>{{ item.Quantity }}</td>
        <td>₹{{ "%.2f"|format(item.Price) }}</td>
        <td>₹{{ "%.2f"|format(item.Subtotal) }}</td>
      </tr>
      {% endfor %}
      <tr class="fw-bold">
        <td colspan="4" class="text-end">Total</td>
        <td>₹{{ "%.2f"|format(total) }}</td>
      </tr>
    </tbody>
  </table>

  <hr>

  <h4>Select Shipping Address</h4>
  <form method="POST" class="mb-4">
    <div class="mb-3">
      {% if addresses %}
      <select name="shipping_address_id" class="form-select" required>
        <option value="">-- Choose Address --</option>
        {% for a in addresses %}
        <option value="{{ a.AddressID }}">
          {{ a.AddressLine1 }}, {{ a.City }} ({{ a.Type }})
        </option>
        {% endfor %}
      </select>
      {% else %}
      <p>No saved addresses. Please add one below.</p>
      {% endif %}
    </div>
    <button type="submit" class="btn btn-success">Place Order</button>
  </form>

  <hr>

  <h4>Add New Address</h4>
  <form method="POST">
    <input type="hidden" name="add_address" value="1">
    <div class="mb-2">
      <input type="text" name="address_line_1" class="form-control" placeholder="Address Line" required>
    </div>
    <div class="mb-2">
      <input type="text" name="city" class="form-control" placeholder="City" required>
    </div>
    <div class="mb-2">
      <input type="text" name="pincode" class="form-control" placeholder="Pincode" required>
    </div>
    <div class="mb-2">
      <select name="type" class="form-select">
        <option>Home</option>
        <option>Work</option>
        <option>Other</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Add Address</button>
  </form>

  {% else %}
  <p>Your cart is empty.</p>
  {% endif %}
</div>
{% endblock %}
